{
  "pluginAlias": "IPortSMButtonsLAN",
  "pluginType": "platform",
  "singular": true,
  "schema": {
    "type": "object",
    "properties": {
      "name": {
        "title": "Name",
        "type": "string",
        "default": "iPort Buttons LAN"
      },
      "ip": {
        "title": "Device IP Address",
        "type": "string",
        "placeholder": "192.168.2.12"
      },
      "port": {
        "title": "Port",
        "type": "integer",
        "default": 10001
      },
      "timeout": {
        "title": "Connection Timeout (ms)",
        "type": "integer",
        "default": 5000
      },
      "reconnectDelay": {
        "title": "Reconnect Delay (ms)",
        "type": "integer",
        "default": 5000
      },
      "triggerResetDelay": {
        "title": "Trigger Reset Delay (ms)",
        "type": "integer",
        "default": 500
      },
      "directControlPort": {
        "title": "Direct Control HTTP Port",
        "type": "integer",
        "default": 3000,
        "description": "Port for direct HTTP control of button actions (bypasses HomeKit for faster response)"
      },
      "buttonMappings": {
        "title": "Button Mappings",
        "type": "array",
        "description": "Each mapping triggers an action when the specified button is pressed and the LED color matches the modeColor. For 'accessory' type, multiple targetNames can be specified to control multiple accessories. For 'brightness' action, a value (0–100) sets the brightness. Actions are executed directly within Homebridge for fastest LAN response, except for 'scene' which uses a virtual switch.",
        "items": {
          "type": "object",
          "properties": {
            "buttonNumber": {
              "title": "Button Number (1–10)",
              "type": "integer",
              "minimum": 1,
              "maximum": 10
            },
            "modeColor": {
              "title": "LED Mode Color",
              "type": "string",
              "enum": ["yellow", "red", "green", "blue", "purple", "white", "any"],
              "default": "any"
            },
            "actionType": {
              "title": "Action Type",
              "type": "string",
              "enum": ["accessory", "scene", "led"],
              "default": "accessory"
            },
            "targetName": {
              "title": "Target Accessory or Scene Name(s)",
              "type": ["string", "array"],
              "items": {
                "type": "string"
              },
              "description": "Name(s) of the target accessory or scene. Use a single string or an array of strings for multiple accessories."
            },
            "action": {
              "title": "Action",
              "type": "string",
              "enum": ["on", "off", "toggle", "brightness"],
              "default": "toggle"
            },
            "value": {
              "title": "Brightness Value (0–100)",
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "description": "Required for action: 'brightness'. Sets the brightness percentage."
            }
          },
          "required": ["buttonNumber", "modeColor", "actionType", "action"],
          "allOf": [
            {
              "if": {
                "properties": { "action": { "const": "brightness" } }
              },
              "then": {
                "required": ["value"]
              }
            }
          ]
        }
      }
    },
    "required": ["ip", "buttonMappings"]
  }
}
